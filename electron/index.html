<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word格式修复工具</title>
    <link rel="stylesheet" href="css/form-generator.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <div class="app-layout">
        <!-- 侧边栏：预设与全局配置 -->
        <aside class="sidebar">
            <div class="brand">
                <h1>Word Format Fixer</h1>
            </div>

            <div class="sidebar-section">
                <h3>场景预设</h3>
                <div class="preset-list">
                    <div class="preset-item active" data-preset="default">
                        <span class="preset-icon">📄</span>
                        <div class="preset-info">
                            <span class="preset-name">默认配置</span>
                            <span class="preset-desc">标准通用规则</span>
                        </div>
                        <div class="preset-actions">
                            <button class="icon-btn edit-preset" title="编辑"
                                onclick="openPresetEditor('default')">✏️</button>
                        </div>
                    </div>
                    <!-- 更多预设项将由JS动态管理，这里保留结构示例，实际内容可能由JS渲染或保留静态 -->
                    <div class="preset-item" data-preset="academic">
                        <span class="preset-icon">🎓</span>
                        <div class="preset-info">
                            <span class="preset-name">学术论文</span>
                            <span class="preset-desc">毕业论文/期刊格式</span>
                        </div>
                        <div class="preset-actions">
                            <button class="icon-btn edit-preset" title="编辑"
                                onclick="openPresetEditor('academic')">✏️</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-outline btn-block mt-10" onclick="openPresetEditor()">+ 新建预设</button>
            </div>

            <div class="sidebar-footer">
                <button class="btn btn-text" id="importConfig">📥 导入配置</button>
                <button class="btn btn-text" id="exportConfig">📤 导出配置</button>
            </div>
        </aside>

        <!-- 主工作区 -->
        <main class="content-area">
            <!-- 顶部工作台：文件操作 -->
            <section class="workspace-header">
                <div class="file-drop-area" id="dropZone">
                    <div class="drop-content">
                        <div class="drop-icon">📁</div>
                        <div class="drop-text">
                            <h3>点击选择或拖拽文件</h3>
                            <p>支持多文件 (.docx) 或文件夹</p>
                        </div>
                        <div class="drop-actions">
                            <button id="selectFile" class="btn btn-primary">选择文件</button>
                            <button id="selectFolder" class="btn btn-secondary">选择文件夹</button>
                            <button id="clearFile" class="btn btn-ghost" style="display: none;">清除</button>
                        </div>
                    </div>

                    <!-- 选中的文件/队列信息 -->
                    <div id="fileInfoPanel" class="file-status-panel" style="display: none;">
                        <div class="status-row">
                            <span id="filePath" class="file-path-badge">已选择文件...</span>
                            <div class="rule-stats">
                                <span>已启用 <b id="enabledRules">0</b> / <span id="totalRules">0</span> 规则</span>
                            </div>
                        </div>

                        <!-- 批量队列 (折叠/展开) -->
                        <div id="batchQueuePanel" class="batch-queue" style="display: none;">
                            <div class="queue-header">
                                <span>处理队列 (<span id="queueCount">0</span>)</span>
                                <span id="batchProgress">0%</span>
                            </div>
                            <div class="progress-track">
                                <div id="batchProgressBar" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div id="fileQueueList" class="queue-items"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 中部：规则配置 -->
            <section class="rules-container">
                <div class="section-header">
                    <h2>规则配置</h2>
                    <div class="bg-actions">
                        <button class="btn btn-sm" id="saveConfig">保存当前配置</button>
                    </div>
                </div>
                <!-- 规则列表容器 -->
                <div class="main-panel" id="rulesContainer">
                    <!-- 规则分类将由JavaScript动态生成 -->
                </div>
            </section>

            <!-- 结果与日志容器 (隐藏) -->
            <div id="resultContainer" style="display: none;">
                <div id="reportStatus"></div>
                <div id="result"></div>
            </div>

            <!-- 底部：执行栏 -->
            <section class="action-bar">
                <div class="status-message">
                    <div id="status" class="status-text">准备就绪</div>
                    <div id="progressBarContainer" class="mini-progress" style="display: none;">
                        <div id="progressBar" class="bar"></div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button id="processFile" class="btn btn-xl btn-primary" disabled>开始处理</button>
                    <button id="stopBatch" class="btn btn-xl btn-danger" style="display: none;">停止处理</button>
                </div>
            </section>
        </main>
    </div>

    <!-- 开发者日志 (隐藏式) -->
    <div class="dev-log-toggle" onclick="toggleDevLog()">🛠️</div>
    <div class="developer-log" id="devLogPanel" style="display: none;">
        <h4>开发者日志</h4>
        <pre id="devLog">等待操作...</pre>
    </div>

    <!-- 动态表单生成器 -->
    <script src="js/form-generator.js"></script>

    <!-- 应用主逻辑 -->
    <script src="js/renderer.js"></script>

    <!-- 预设编辑器模态框 -->
    <div id="presetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">预设编辑器</h2>
                <span class="close" onclick="closePresetEditor()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="presetName">预设名称</label>
                    <input type="text" id="presetName" placeholder="请输入预设名称">
                </div>
                <div class="form-group">
                    <label for="presetDescription">预设描述</label>
                    <textarea id="presetDescription" placeholder="请输入预设描述"></textarea>
                </div>
                <div id="ruleSelection" class="rule-selection">
                    <!-- 规则选择列表将由JavaScript动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePresetEditor()">取消</button>
                <button class="btn btn-primary" id="savePreset">保存</button>
            </div>
        </div>
    </div>
</body>

</html>